<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetroSahayak - Delhi Metro Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dmrc-red: #C0282C;
            --metro-blue: #02555B;
            --station-grey: #F2F2F2;
            --highlight-yellow: #FFCE00;
            --text-dark: #2C3E50;
            --shadow-color: rgba(0, 0, 0, 0.15);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideRight {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100vw); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Animated Background Particles */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(192, 40, 44, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            box-shadow: 
                0 30px 90px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 850px;
            backdrop-filter: blur(20px);
            position: relative;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .header {
            background: linear-gradient(135deg, var(--dmrc-red) 0%, #8B1F23 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 20px rgba(192, 40, 44, 0.3);
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 70%
            );
            animation: shimmer 3s infinite;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .animated-train {
            width: 60px;
            height: 40px;
            animation: float 3s ease-in-out infinite;
        }

        .train-body {
            fill: white;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        .train-window {
            fill: var(--metro-blue);
            animation: pulse 2s ease-in-out infinite;
        }

        .train-wheel {
            fill: var(--highlight-yellow);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 5px;
            letter-spacing: 2px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 15px;
            opacity: 0.95;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        /* 3D Mascot */
        .mascot {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            animation: float 4s ease-in-out infinite;
            z-index: 10;
        }

        .mascot-icon {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            border-radius: 50%;
            box-shadow: 
                5px 5px 15px rgba(0, 0, 0, 0.2),
                -5px -5px 15px rgba(255, 255, 255, 0.7),
                inset 2px 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        .mascot-icon:hover {
            transform: rotateY(180deg);
        }

        .tabs {
            display: flex;
            gap: 0;
            background: white;
            border-bottom: 3px solid var(--station-grey);
            padding: 0 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: white;
            color: #666;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            border-bottom: 4px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 4px;
            background: var(--dmrc-red);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .tab-btn:hover {
            color: var(--dmrc-red);
            background: rgba(192, 40, 44, 0.05);
        }

        .tab-btn:hover::before {
            width: 100%;
        }

        .tab-btn.active {
            color: var(--dmrc-red);
            background: linear-gradient(to bottom, rgba(192, 40, 44, 0.05), white);
        }

        .tab-btn.active::before {
            width: 100%;
        }

        .tab-icon {
            width: 20px;
            height: 20px;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: none;
            background: linear-gradient(to bottom, var(--station-grey), white);
        }

        .content.active {
            display: flex;
            flex-direction: column;
        }

        .chat-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.05),
                0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-track {
            background: var(--station-grey);
            border-radius: 10px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--metro-blue);
            border-radius: 10px;
        }

        .message {
            padding: 15px 20px;
            border-radius: 18px;
            max-width: 75%;
            word-wrap: break-word;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform-style: preserve-3d;
        }

        .message::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .message.bot {
            background: linear-gradient(135deg, var(--station-grey) 0%, #e8e8e8 100%);
            color: var(--text-dark);
            align-self: flex-start;
            border-radius: 18px 18px 18px 4px;
            border-left: 4px solid var(--metro-blue);
        }

        .message.bot::before {
            bottom: 0;
            left: -10px;
            border-width: 0 10px 10px 0;
            border-color: transparent var(--station-grey) transparent transparent;
        }

        .message.user {
            background: linear-gradient(135deg, var(--metro-blue) 0%, #014247 100%);
            color: white;
            align-self: flex-end;
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 6px 20px rgba(2, 85, 91, 0.3);
        }

        .message.user::before {
            bottom: 0;
            right: -10px;
            border-width: 0 0 10px 10px;
            border-color: transparent transparent #014247 transparent;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .input-area {
            display: flex;
            gap: 12px;
            padding: 15px;
            background: white;
            border-radius: 25px;
            box-shadow: 
                0 -4px 20px rgba(0, 0, 0, 0.1),
                0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .input-area input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid var(--station-grey);
            border-radius: 25px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-area input:focus {
            outline: none;
            border-color: var(--metro-blue);
            box-shadow: 0 0 0 4px rgba(2, 85, 91, 0.1);
            transform: translateY(-2px);
        }

        .input-area button {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--dmrc-red) 0%, #8B1F23 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(192, 40, 44, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-area button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(192, 40, 44, 0.4);
        }

        .input-area button:active {
            transform: translateY(-1px) scale(1.02);
        }

        .loading {
            display: flex;
            gap: 8px;
            padding: 15px 20px;
            align-self: flex-start;
            background: var(--station-grey);
            border-radius: 18px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading span {
            width: 10px;
            height: 10px;
            background: var(--metro-blue);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-action {
            padding: 15px;
            background: white;
            border-radius: 15px;
            border: 2px solid var(--station-grey);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .quick-action:hover {
            border-color: var(--metro-blue);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(2, 85, 91, 0.2);
        }

        .quick-action-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .quick-action-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Route Form Styles */
        .route-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-group label {
            font-weight: 700;
            color: var(--text-dark);
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group select {
            padding: 15px 20px;
            border: 2px solid var(--station-grey);
            border-radius: 12px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2302555B' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 45px;
        }

        .form-group select:focus {
            outline: none;
            border-color: var(--metro-blue);
            box-shadow: 0 0 0 4px rgba(2, 85, 91, 0.1);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--dmrc-red) 0%, #8B1F23 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(192, 40, 44, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(192, 40, 44, 0.4);
        }

        /* Route Display */
        .route-display {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }

        .route-display h3 {
            color: var(--dmrc-red);
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 3px solid var(--highlight-yellow);
            padding-bottom: 10px;
        }

        .route-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--station-grey);
            border-radius: 12px;
        }

        .route-info p {
            font-size: 15px;
            display: flex;
            justify-content: space-between;
        }

        .route-info strong {
            color: var(--metro-blue);
        }

        .stations-list {
            margin: 20px 0;
        }

        .stations-list h4 {
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stations-list h4::before {
            content: 'üöá';
            font-size: 24px;
        }

        .station-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: white;
            border-left: 4px solid var(--metro-blue);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .station-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .station-number {
            width: 30px;
            height: 30px;
            background: var(--metro-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 13px;
            flex-shrink: 0;
        }

        .station-name {
            flex: 1;
            font-weight: 600;
            color: var(--text-dark);
        }

        .fare-info {
            background: linear-gradient(135deg, var(--highlight-yellow) 0%, #FFD700 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .fare-info h4 {
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .fare-info p {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        .fare-info p:last-child {
            border-bottom: none;
        }

        .fare-amount {
            color: var(--dmrc-red);
            font-size: 18px;
            font-weight: 700;
        }

        /* Emergency Styles */
        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .contact-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-top: 4px solid var(--dmrc-red);
        }

        .contact-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 35px rgba(192, 40, 44, 0.2);
        }

        .contact-card h3 {
            color: var(--metro-blue);
            margin-bottom: 15px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .contact-card p {
            font-size: 24px;
            font-weight: 700;
            color: var(--dmrc-red);
        }

        .emergency-tips {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .emergency-tips h3 {
            color: var(--dmrc-red);
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 3px solid var(--highlight-yellow);
            padding-bottom: 10px;
        }

        .emergency-tips ul {
            list-style: none;
        }

        .emergency-tips li {
            padding: 12px 0 12px 35px;
            position: relative;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-dark);
        }

        .emergency-tips li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: var(--metro-blue);
            font-weight: 700;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .container {
                height: 95vh;
                border-radius: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .mascot {
                width: 60px;
                height: 60px;
                right: 10px;
                top: 10px;
            }

            .tab-btn {
                font-size: 13px;
                padding: 12px 10px;
            }

            .message {
                max-width: 85%;
            }

            .quick-actions {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Mascot -->
        <div class="mascot">
            <div class="mascot-icon">üöá</div>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <svg class="animated-train" viewBox="0 0 80 60" xmlns="http://www.w3.org/2000/svg">
                    <!-- Train Body -->
                    <rect class="train-body" x="10" y="15" width="60" height="30" rx="5"/>
                    
                    <!-- Windows -->
                    <rect class="train-window" x="20" y="20" width="10" height="12" rx="2"/>
                    <rect class="train-window" x="35" y="20" width="10" height="12" rx="2"/>
                    <rect class="train-window" x="50" y="20" width="10" height="12" rx="2"/>
                    
                    <!-- Wheels -->
                    <circle class="train-wheel" cx="25" cy="45" r="5"/>
                    <circle class="train-wheel" cx="55" cy="45" r="5"/>
                    
                    <!-- Front Light -->
                    <circle cx="8" cy="30" r="3" fill="#FFCE00"/>
                </svg>
                <div>
                    <h1>MetroSahayak</h1>
                    <p>üáÆüá≥ Your Delhi Metro Assistant</p>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('chat')">
                <svg class="tab-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
                </svg>
                Chat
            </button>
            <button class="tab-btn" onclick="switchTab('route')">
                <svg class="tab-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12 1.586l-4 4v12.828l4-4V1.586zM3.707 3.293A1 1 0 002 4v10a1 1 0 00.293.707L6 18.414V5.586L3.707 3.293zM17.707 5.293L14 1.586v12.828l2.293 2.293A1 1 0 0018 16V6a1 1 0 00-.293-.707z" clip-rule="evenodd"/>
                </svg>
                Routes
            </button>
            <button class="tab-btn" onclick="switchTab('emergency')">
                <svg class="tab-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                Emergency
            </button>
        </div>

        <!-- Chat Tab -->
        <div id="chat" class="content active">
            <div class="chat-content">
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('What are the metro timings?')">
                        <div class="quick-action-icon">‚è∞</div>
                        <div class="quick-action-text">Metro Timings</div>
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('How to recharge metro card?')">
                        <div class="quick-action-icon">üí≥</div>
                        <div class="quick-action-text">Card Recharge</div>
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('Show me all metro lines')">
                        <div class="quick-action-icon">üó∫Ô∏è</div>
                        <div class="quick-action-text">Metro Lines</div>
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('What are the peak hours?')">
                        <div class="quick-action-icon">üìä</div>
                        <div class="quick-action-text">Peak Hours</div>
                    </div>
                </div>

                <div class="messages" id="messages">
                    <div class="message bot">
                        üëã Welcome to MetroSahayak! I'm your Delhi Metro assistant. Ask me about:
                        <br><br>
                        üöá Routes & Stations
                        <br>üí∞ Fares & Cards
                        <br>‚è∞ Timings & Schedules
                        <br>üó∫Ô∏è Metro Lines
                        <br>üö® Emergency Help
                        <br><br>
                        How can I help you today?
                    </div>
                </div>
                <div class="input-area">
                    <input type="text" id="chatInput" placeholder="Ask about routes, fares, timings, or emergency help..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button onclick="sendMessage()">Send ‚úàÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- Route Tab -->
        <div id="route" class="content">
            <div class="route-form">
                <div class="form-group">
                    <label>üìç From Station</label>
                    <select id="fromStation">
                        <option value="">Select a station...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üéØ To Station</label>
                    <select id="toStation">
                        <option value="">Select a station...</option>
                    </select>
                </div>
                <button class="search-btn" onclick="findRoute()">üîç Search Route</button>
            </div>
            <div id="routeResults" style="flex: 1; overflow-y: auto;"></div>
        </div>

        <!-- Emergency Tab -->
        <div id="emergency" class="content">
            <div class="emergency-grid">
                <div class="contact-card">
                    <h3>üìû Customer Care</h3>
                    <p>155370</p>
                </div>
                <div class="contact-card">
                    <h3>üõ°Ô∏è Security (CISF)</h3>
                    <p>155655</p>
                </div>
                <div class="contact-card">
                    <h3>üì¶ Lost & Found</h3>
                    <p>Kashmere Gate</p>
                </div>
                <div class="contact-card">
                    <h3>üè• Medical</h3>
                    <p>155370</p>
                </div>
                <div class="contact-card">
                    <h3>üë© Women Safety</h3>
                    <p>155370</p>
                </div>
                <div class="contact-card">
                    <h3>üö® Police</h3>
                    <p>100</p>
                </div>
            </div>
            <div class="emergency-tips">
                <h3>üõ°Ô∏è Safety Tips</h3>
                <ul>
                    <li>Keep your belongings safe and secure at all times</li>
                    <li>Use designated women's coaches during peak hours</li>
                    <li>Report any suspicious activity or unattended baggage immediately</li>
                    <li>Keep emergency contact numbers saved in your phone</li>
                    <li>Wait in designated waiting areas on platforms</li>
                    <li>Stand behind the yellow line while waiting for trains</li>
                    <li>Avoid traveling alone late at night if possible</li>
                    <li>Keep your metro card/token ready before entering gates</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';

        // Enhanced chatbot knowledge base
        const CHATBOT_KNOWLEDGE = {
            timings: {
                keywords: ['timing', 'time', 'open', 'close', 'schedule', 'hours'],
                response: `üïê Delhi Metro Operating Hours:

Monday to Saturday: 6:00 AM - 11:00 PM
Sunday: 6:00 AM - 10:00 PM

First Train: Around 5:00 AM - 6:00 AM (varies by line)
Last Train: Around 10:30 PM - 11:30 PM (varies by line)

Note: Timings may vary on special occasions and public holidays.`
            },
            recharge: {
                keywords: ['recharge', 'topup', 'top-up', 'reload', 'card'],
                response: `üí≥ Metro Card Recharge Methods:

1. At Metro Stations:
   - AFC (Automatic Fare Collection) counters
   - TVM (Ticket Vending Machines)
   - Recharge kiosks

2. Online Methods:
   - Delhi Metro Rail App (DMRC)
   - Paytm, PhonePe, Google Pay
   - Official DMRC website

3. Mobile Wallets:
   - Link your metro card
   - Auto-recharge options available

Minimum recharge: ‚Çπ100
Maximum balance: ‚Çπ3000`
            },
            lines: {
                keywords: ['line', 'lines', 'color', 'route map'],
                response: `üó∫Ô∏è Delhi Metro Lines:

üî¥ Red Line: Rithala - Shaheed Sthal (New Bus Adda)
üîµ Blue Line: Dwarka Sector 21 - Noida Electronic City/Vaishali
üü° Yellow Line: Samaypur Badli - HUDA City Centre
üü¢ Green Line: Brigadier Hoshiar Singh - Kirti Nagar
üü£ Violet Line: Kashmere Gate - Raja Nahar Singh (Ballabhgarh)
üü† Orange Line: AIIMS - New Delhi (Airport Express)
ü©∑ Pink Line: Majlis Park - Shiv Vihar
ü©∂ Grey Line: Dwarka - Najafgarh
‚ö™ Rapid Metro: Sikanderpur - Cyber City

Total: 350+ stations across 390+ km`
            },
            peak: {
                keywords: ['peak', 'rush', 'busy', 'crowd'],
                response: `üìä Peak Hours & Off-Peak Timings:

Morning Peak Hours:
üî∫ 8:00 AM - 10:00 AM

Evening Peak Hours:
üî∫ 5:00 PM - 8:00 PM

Off-Peak Hours:
‚úÖ 10:00 AM - 5:00 PM
‚úÖ After 8:00 PM

üí° Tip: Travel during off-peak hours for:
- Less crowded trains
- Discounted fares (10% off on smart cards)
- More comfortable journey`
            },
            fare: {
                keywords: ['fare', 'price', 'cost', 'ticket', 'charge'],
                response: `üí∞ Delhi Metro Fare Structure:

Distance-based fares:
üìç 0-2 km: ‚Çπ10
üìç 2-5 km: ‚Çπ20
üìç 5-12 km: ‚Çπ30
üìç 12-21 km: ‚Çπ40
üìç 21-32 km: ‚Çπ50
üìç 32+ km: ‚Çπ60

Airport Express Line:
‚úàÔ∏è ‚Çπ60 (New Delhi to Airport)

Smart Card Benefits:
üí≥ 10% discount on every journey
üí≥ Faster entry/exit
üí≥ No need to buy tokens

Senior Citizens & Students: 50% discount on smart cards`
            },
            airport: {
                keywords: ['airport', 'flight', 'terminal', 'igi'],
                response: `‚úàÔ∏è Delhi Airport Metro Connection:

Orange Line (Airport Express):
üî∏ New Delhi ‚Üí IGI Airport T3
üî∏ Stations: New Delhi, Shivaji Stadium, Dhaula Kuan, Airport (T3)

Travel Time: ~20 minutes
Frequency: Every 10-15 minutes
Fare: ‚Çπ60

You can also use:
- Pink Line to Aerocity
- Yellow Line to nearest station + cab

üí° Tip: Airport Express is fastest! Luggage space available.`
            },
            card_types: {
                keywords: ['smart card', 'token', 'card type', 'payment'],
                response: `üé´ Metro Ticket & Card Types:

1. Metro Smart Card:
   üí≥ Reusable, rechargeable
   üí≥ 10% discount on fares
   üí≥ Deposit: ‚Çπ50 (refundable)
   üí≥ Validity: 10 years

2. Tokens:
   ü™ô Single journey
   ü™ô No discount
   ü™ô Available at TVMs

3. QR Code Tickets:
   üì± Via DMRC app
   üì± One-time use
   üì± Contactless

4. National Common Mobility Card (NCMC):
   üåê Works on multiple transport systems
   üåê Available soon

üí° Recommendation: Smart Card for regular travelers`
            },
            lost_found: {
                keywords: ['lost', 'found', 'missing', 'forgot'],
                response: `üì¶ Lost & Found:

Main Office:
üìç Kashmere Gate Metro Station
üìû 011-23417910
‚è∞ 8:00 AM - 8:00 PM (Mon-Sat)

Online Complaint:
üåê www.delhimetrorail.com
üìß Report through DMRC app

What to do:
1. Report to station manager immediately
2. File written complaint
3. Provide item description & journey details
4. Keep contact info updated

üí° Unclaimed items are kept for 3 months`
            },
            wifi: {
                keywords: ['wifi', 'internet', 'connectivity', 'data'],
                response: `üì∂ Delhi Metro WiFi:

Free WiFi Available at:
‚úÖ All underground stations
‚úÖ Major interchange stations

How to Connect:
1. Search for "DelhiMetro-Wifi"
2. Accept terms & conditions
3. Enter mobile number
4. Receive OTP & login

Speed: Good for browsing
Duration: Continuous during journey

üí° Tip: Download content before boarding for uninterrupted entertainment!`
            },
            parking: {
                keywords: ['parking', 'park', 'vehicle', 'car'],
                response: `üÖøÔ∏è Metro Station Parking:

Available at major stations:
- Noida Sector 16
- Dwarka Sector 21
- Kashmere Gate
- Rajiv Chowk
- Many more...

Charges (approx):
üöó Cars: ‚Çπ40 for first 4 hours
üèçÔ∏è Two-wheelers: ‚Çπ20 for first 4 hours

Facilities:
‚úÖ Secure parking
‚úÖ CCTV surveillance
‚úÖ Pay & Park facilities

üí° Tip: Use Park & Ride to avoid city traffic!`
            },
            facilities: {
                keywords: ['facilities', 'amenities', 'washroom', 'atm'],
                response: `üè¢ Metro Station Facilities:

Available at Most Stations:
‚úÖ Clean Washrooms (paid)
‚úÖ ATMs
‚úÖ Drinking Water
‚úÖ First Aid
‚úÖ Elevators & Escalators
‚úÖ Help Desks

Special Facilities:
‚ôø Wheelchair assistance
üë∂ Baby care rooms (select stations)
üõí Retail shops
‚òï Cafes (major stations)
üì± Mobile charging points

üí° Staff available 24/7 for assistance!`
            },
            rules: {
                keywords: ['rule', 'rules', 'allowed', 'prohibited', 'banned'],
                response: `‚ö†Ô∏è Metro Rules & Regulations:

‚ùå PROHIBITED:
- Smoking, eating, drinking
- Carrying flammable items
- Pets (except guide dogs)
- Playing music without earphones
- Spitting, littering
- Photography/Videography without permission

‚úÖ ALLOWED:
- 2 pieces of luggage (max 25kg each)
- Laptops, electronics
- Folded bicycles (in designated coaches)
- Musical instruments (properly covered)

‚öñÔ∏è Penalties:
Fine up to ‚Çπ500 for violations

üí° Follow rules for everyone's safety!`
            }
        };

        // Load stations on page load
        window.addEventListener('load', loadStations);

        function switchTab(tabName) {
            // Hide all content
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function loadStations() {
            try {
                const linesResp = await fetch(`${API_BASE_URL}/lines`);
                if (!linesResp.ok) throw new Error('Failed to load lines');
                const linesData = await linesResp.json();
                
                let allStations = new Set();
                for (const line of linesData.lines) {
                    try {
                        const stationsResp = await fetch(`${API_BASE_URL}/stations/${line.code}`);
                        if (!stationsResp.ok) throw new Error(`Failed to load stations for ${line.code}`);
                        const stationsData = await stationsResp.json();
                        stationsData.stations.forEach(s => allStations.add(s));
                    } catch (e) {
                        console.warn(`Error loading line ${line.code}:`, e);
                    }
                }

                const stations = Array.from(allStations).sort();
                
                // Populate dropdowns efficiently
                const fromSelect = document.getElementById('fromStation');
                const toSelect = document.getElementById('toStation');
                
                const fragment = document.createDocumentFragment();
                stations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station;
                    option.textContent = station;
                    fragment.appendChild(option);
                });
                
                fromSelect.innerHTML = '<option value="">Select From Station...</option>';
                toSelect.innerHTML = '<option value="">Select To Station...</option>';
                fromSelect.appendChild(fragment.cloneNode(true));
                toSelect.appendChild(fragment.cloneNode(true));
                
                console.log(`Loaded ${stations.length} stations successfully`);
            } catch (error) {
                console.error('Error loading stations:', error);
                const fromSelect = document.getElementById('fromStation');
                const toSelect = document.getElementById('toStation');
                fromSelect.innerHTML = '<option value="">‚ö†Ô∏è Error loading stations</option>';
                toSelect.innerHTML = '<option value="">‚ö†Ô∏è Error loading stations</option>';
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Show loading
            const messagesDiv = document.getElementById('messages');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.innerHTML = '<span></span><span></span><span></span>';
            loadingDiv.id = 'loading';
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Check local knowledge base first
            const response = getLocalResponse(message);
            
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) loading.remove();
                
                if (response) {
                    addMessage(response, 'bot');
                } else {
                    // Try API if local knowledge doesn't have answer
                    callAPI(message).catch(e => {
                        addMessage('I can help you with metro routes, timings, fares, and more! Try asking about specific topics like "metro timings" or "how to recharge card".', 'bot');
                    });
                }
            }, 800);
        }

        function getLocalResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            for (const [key, data] of Object.entries(CHATBOT_KNOWLEDGE)) {
                if (data.keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return data.response;
                }
            }
            
            return null;
        }

        async function callAPI(message) {
            try {
                const response = await fetch(`${API_BASE_URL}/assistant`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: message, language: 'en' })
                });

                if (!response.ok) {
                    const errData = await response.json().catch(() => ({}));
                    throw new Error(errData.detail || `Assistant API error: ${response.status}`);
                }

                const data = await response.json();
                addMessage(data.response || 'Sorry, I could not process your request.', 'bot');

                if (Array.isArray(data.sources) && data.sources.length > 0) {
                    renderSources(data.sources);
                }
            } catch (error) {
                console.error('API call error:', error);
                addMessage('I can help you with metro routes, timings, fares, and more! Try asking about specific topics like "metro timings" or "how to recharge card".', 'bot');
            }
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            messageEl.innerHTML = text.replace(/\n/g, '<br>');
            messagesDiv.appendChild(messageEl);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function renderSources(sources) {
            try {
                const messagesDiv = document.getElementById('messages');
                const container = document.createElement('div');
                container.style.fontSize = '13px';
                container.style.color = '#333';
                container.style.margin = '8px 0 18px 0';
                container.style.alignSelf = 'flex-start';

                const title = document.createElement('div');
                title.style.fontWeight = '700';
                title.style.marginBottom = '6px';
                title.textContent = 'Sources:';
                container.appendChild(title);

                sources.forEach(src => {
                    const item = document.createElement('div');
                    item.style.marginBottom = '6px';

                    const a = document.createElement('a');
                    a.href = src.link || '#';
                    a.target = '_blank';
                    a.rel = 'noopener noreferrer';
                    a.style.color = '#02555B';
                    a.style.fontWeight = '600';
                    a.textContent = src.title || (src.link || src.site || 'source');

                    const snippet = document.createElement('div');
                    snippet.style.color = '#555';
                    snippet.style.fontSize = '12px';
                    snippet.textContent = src.snippet || '';

                    item.appendChild(a);
                    if (src.snippet) item.appendChild(snippet);
                    container.appendChild(item);
                });

                messagesDiv.appendChild(container);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } catch (e) {
                console.warn('Failed to render sources', e);
            }
        }

        async function findRoute() {
            const from = document.getElementById('fromStation').value;
            const to = document.getElementById('toStation').value;
            const resultsDiv = document.getElementById('routeResults');

            if (!from || !to) {
                resultsDiv.innerHTML = '<div class="message bot">‚ùå Please select both starting and destination stations</div>';
                return;
            }

            if (from === to) {
                resultsDiv.innerHTML = '<div class="message bot">‚ùå Starting and destination stations must be different</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';

            try {
                const response = await fetch(`${API_BASE_URL}/route`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ from_station: from, to_station: to, language: 'en' })
                });

                const data = await response.json();

                if (!response.ok) {
                    resultsDiv.innerHTML = `<div class="message bot">‚ùå ${data.detail || 'Failed to find route'}</div>`;
                    return;
                }

                displayRoute(data, resultsDiv);
            } catch (error) {
                console.error('Route finding error:', error);
                resultsDiv.innerHTML = `<div class="message bot">‚ùå Error: ${error.message}. Please check your connection and try again.</div>`;
            }
        }

        function displayRoute(route, container) {
            let html = `
                <div class="route-display">
                    <h3>‚úÖ Route Found!</h3>
                    <div class="route-info">
                        <p><strong>From:</strong> <span>${route.from_station}</span></p>
                        <p><strong>To:</strong> <span>${route.to_station}</span></p>
                        <p><strong>Distance:</strong> <span>${route.distance} stations</span></p>
                    </div>

                    <div class="stations-list">
                        <h4>Journey Path</h4>
                        ${route.stations.map((s, i) => `
                            <div class="station-item">
                                <span class="station-number">${i + 1}</span>
                                <span class="station-name">${s}</span>
                            </div>
                        `).join('')}
                    </div>

                    ${route.interchanges.length > 0 ? `
                        <div class="stations-list">
                            <h4>üîÑ Interchange Stations</h4>
                            ${route.interchanges.map(i => `
                                <div class="station-item">
                                    <strong>${i.station}</strong>
                                    <span style="font-size: 12px; color: #666; margin-left: auto;">${i.lines.join(' ‚Üî ')}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div class="fare-info">
                        <h4>üí∞ Fare Details</h4>
                        <p><span>Token Fare:</span> <span class="fare-amount">‚Çπ${route.fare.base_fare}</span></p>
                        <p><span>Off-Peak Fare:</span> <span class="fare-amount">‚Çπ${route.fare.off_peak_fare}</span></p>
                        <p><span>Smart Card:</span> <span class="fare-amount">‚Çπ${route.fare.smart_card_fare}</span></p>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }
    </script>
</body>
</html>
